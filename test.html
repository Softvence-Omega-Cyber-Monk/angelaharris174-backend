<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time Notification Tester</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background-color: #f4f7f6; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h2 { color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        #status { padding: 10px; border-radius: 5px; margin-bottom: 20px; font-weight: bold; }
        .online { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .offline { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .notification-card { background: #fff; border-left: 5px solid #007bff; padding: 15px; margin-bottom: 10px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); animation: slideIn 0.3s ease-out; }
        .notification-card h4 { margin: 0 0 5px 0; color: #007bff; }
        .notification-card p { margin: 0; color: #555; font-size: 14px; }
        .time { font-size: 11px; color: #999; display: block; margin-top: 8px; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        #no-notif { color: #999; text-align: center; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <h2>ðŸ”” Live Notifications</h2>
    
    <div id="status" class="offline">Status: Disconnected</div>

    <div id="notification-list">
        <p id="no-notif">No new notifications yet. Try liking a post!</p>
    </div>
</div>

<script>
    const RECIPIENT_ID = "153ef600-d2e5-4c78-8f28-bb12767ccda1"; 

    const socket = io("http://localhost:5000", {
        query: { userId: RECIPIENT_ID }
    });

    const statusDiv = document.getElementById('status');
    const listDiv = document.getElementById('notification-list');
    const noNotif = document.getElementById('no-notif');

    socket.on("connect", () => {
        statusDiv.innerText = `Status: Connected (User ID: ${RECIPIENT_ID})`;
        statusDiv.className = "online";
        console.log("Connected with Socket ID:", socket.id);
    });

    socket.on("connect_error", (err) => {
        statusDiv.innerText = "Status: Connection Error!";
        statusDiv.className = "offline";
        console.error("Connection Error:", err.message);
    });

    socket.on("notification", (data) => {
        console.log("New Notification Received:", data);
        
        if (noNotif) noNotif.remove();

        const card = document.createElement('div');
        card.className = 'notification-card';
        card.innerHTML = `
            <h4>${data.title}</h4>
            <p>${data.message}</p>
            <span class="time">${new Date(data.createdAt).toLocaleString()}</span>
        `;

        listDiv.prepend(card);

        if (Notification.permission === "granted") {
            new Notification(data.title, { body: data.message });
        }
    });

    if (Notification.permission !== "denied") {
        Notification.requestPermission();
    }
</script>

</body>
</html>